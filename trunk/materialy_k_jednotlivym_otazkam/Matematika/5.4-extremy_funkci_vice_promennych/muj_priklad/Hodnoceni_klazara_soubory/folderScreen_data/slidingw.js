{SlidingWindow=function(){this.imageUrl="";this.closeImageUrl="";this.callbackMethod=null;this.callbackObject=window;this.position="center";this.verticalOffsetPosition=0;this.horizontalOffsetPosition=0;this.showTime=1;this.showAfter=1;this.closeButtonOffsetTop=0;this.closeButtonOffsetRight=0;this.manualStart=false;this.noActionPeriods=[2,4,10];this.closeActionPeriods=[14,30,90];this.minorPeriodRepetition=1;this.measureDotUrl=null;this.debug=0;this.baseId="slidingWindow";this.imageId=this.baseId+"Image";this.closeImageId=this.imageId+"Close";this.animationTime=10;this.animationOrientation="down";this.animationStartTimeStamp="";this.animationPxLength=0;this.animationCurrentPosition=0;this.interval=null;this.timer=null;this.animationSpeed=0;this.error=false;this.retryCookieName=this.baseId+"RetryCookie";this.typeCookieName=this.baseId+"TypeCookie";this.minorRetryCookieName=this.baseId+"MinorRetryCookie";this.cookies=null;this.cookieSaved=false;this.windowShowed=false;this.dom=null;};SlidingWindow.prototype.init=function(settings){if(!settings.imageUrl){this._error("Parameter imageUrl must be set!");}else{this.imageUrl=settings.imageUrl;}if(!settings.closeImageUrl){this._error("Parameter closeImageUrl must be set!");}else{this.closeImageUrl=settings.closeImageUrl;}if(settings.showTime){this.showTime=settings.showTime*1;}if(settings.showAfter){this.showAfter=settings.showAfter*1;}if(settings.noActionPeriods){this.noActionPeriods=settings.noActionPeriods;}if(settings.closeActionPeriods){this.closeActionPeriods=settings.closeActionPeriods;}if(settings.verticalOffsetPosition){this.verticalOffsetPosition=settings.verticalOffsetPosition*1;}if(settings.horizontalOffsetPosition){this.horizontalOffsetPosition=settings.horizontalOffsetPosition*1;}if(settings.closeButtonOffsetTop){this.closeButtonOffsetTop=settings.closeButtonOffsetTop*1;}if(settings.closeButtonOffsetRight){this.closeButtonOffsetRight=settings.closeButtonOffsetRight*1;}if(settings.animationTime){this.animationTime=settings.animationTime*1;}if(settings.retryCount){this.retryCount=settings.retryCount*1;}if(settings.longPeriod){this.longPeriod=settings.longPeriod*1;}if(settings.closePeriod){this.closePeriod=settings.closePeriod*1;}if(settings.minorPeriodRepetition){this.minorPeriodRepetition=settings.minorPeriodRepetition*1;}if(settings.callbackMethod){this.callbackMethod=settings.callbackMethod;}if(settings.callbackObject){this.callbackObject=settings.callbackObject;}if(settings.manualStart){this.manualStart=settings.manualStart;}if(settings.measureDotUrl){this.measureDotUrl=settings.measureDotUrl;}if(settings.position){if(settings.position.toLowerCase()=="left"){this.position="left";}if(settings.position.toLowerCase()=="right"){this.position="right";}}if(!this.error&&!this.manualStart&&this.canShow()){this.addListener(window,"load",this,"startOnLoad");}this.addListener(window,"unload",this,"_windowUnloadAction");};SlidingWindow.prototype._windowUnloadAction=function(e,elm){if(this._isCookieEnabled()&&this._isSupportedBrowser()){if(document.cookie.indexOf(this.baseId+"=")==-1){if(!this.cookieSaved&&this.windowShowed){this.actualizeCookie();}}}};SlidingWindow.prototype.start=function(){if(!this.error&&this.manualStart&&this.canShow()){this.manualStart=false;this.startOnLoad();}};SlidingWindow.prototype.startOnLoad=function(e,elm){if(!this.error){this.measure("show");var div=document.createElement("div");div.id=this.baseId;this.dom=div;div.style.position="absolute";div.style.zIndex="1001";div.style.top="-1000px";div.style.left="-1000px";div.style.cursor="pointer";var img=document.createElement("img");img.id=this.imageId;div.appendChild(img);if(this.callbackMethod!=null){this.addListener(img,"click",this.callbackObject,this.callbackMethod);}this.addListener(img,"click",this,"mainImageClick");var close=document.createElement("img");close.id=this.closeImageId;close.style.position="absolute";close.style.zIndex="1002";close.style.top=this.closeButtonOffsetTop+"px";close.style.right=this.closeButtonOffsetRight+"px";close.src=this.closeImageUrl;div.appendChild(close);this.addListener(img,"load",this,"prepareAnimation");img.src=this.imageUrl;}};SlidingWindow.prototype.prepareAnimation=function(e,elm){document.getElementsByTagName("body")[0].appendChild(this.dom);var image=document.getElementById(this.imageId);var div=document.getElementById(this.baseId);var winWidth=Math.max(document.documentElement.clientWidth,document.body.clientWidth);div.style.width=image.width+"px";div.style.height=image.height+"px";div.style.top="-"+image.height+"px";if(this.position=="left"){div.style.left=this.horizontalOffsetPosition+"px";}else{if(this.position=="right"){div.style.left=winWidth-image.width-this.horizontalOffsetPosition+"px";}else{div.style.left=((winWidth/2)-(image.width/2))+"px";}}this.animationPxLength=image.height+this.verticalOffsetPosition;this.setAnimationSpeed(image.height);this.animate=this.bind(this,this.animate);this.startAnimation=this.bind(this,this.startAnimation);this.animationCurrentPosition=-image.height;this.startAnimation();};SlidingWindow.prototype.startAnimation=function(){this.animationStartTimeStamp=new Date().getTime();this.interval=setInterval(this.animate,this.animationSpeed);};SlidingWindow.prototype.animate=function(){var now=new Date();var speed=this.animationPxLength/this.animationTime;var nextPosition=0;var div=document.getElementById(this.baseId);if(this.animationOrientation=="down"){nextPosition=this.animationCurrentPosition+(speed*((now.getTime()-this.animationStartTimeStamp)/1000));if(nextPosition>=0){this.windowShowed=true;clearInterval(this.interval);div.style.top=this.verticalOffsetPosition+"px";this.animationOrientation="up";this.timer=setTimeout(this.startAnimation,this.showTime*60*1000);this.addListener(document.getElementById(this.closeImageId),"click",this,"closeImageClick");}else{div.style.top=nextPosition+"px";this.animationCurrentPosition=nextPosition;}}else{nextPosition=this.animationCurrentPosition-(speed*((now.getTime()-this.animationStartTimeStamp)/1000));if(nextPosition<-this.animationPxLength){clearInterval(this.interval);this.windowShowed=false;div.style.top=-this.animationPxLength;div.style.display="none";this.actualizeCookie();}else{div.style.top=nextPosition+"px";this.animationCurrentPosition=nextPosition;}}};SlidingWindow.prototype.setAnimationSpeed=function(height){var animationStep;if(this.animationPxLength<=50){animationStep=1;}else{if(this.animationPxLength<=100){animationStep=2;}else{animationStep=4;}}var steps=Math.ceil(height/animationStep);if(this.animationTime/steps<0.05){animationStep*=2;}steps=Math.ceil(height/animationStep);this.animationSpeed=Math.round(Math.max(this.animationTime/steps*1000,25));};SlidingWindow.prototype.setMeasureDotUrl=function(url){this.measureDotUrl=url;};SlidingWindow.prototype.closeImageClick=function(e,elm){this.measure("hide");var cookieRetry=0;if(this.getLastActionFromCookie()=="close"){cookieRetry=parseInt(this.getRetryCountFromCookie())+1;}if(cookieRetry>=this.closeActionPeriods.length){cookieRetry=0;}this._setCookie(this.closeActionPeriods[cookieRetry],cookieRetry,"close");this._deleteMinorCookie();this.cookieSaved=true;clearTimeout(this.timer);this.animationOrientation="up";this.startAnimation();};SlidingWindow.prototype.mainImageClick=function(e,elm){this.measure("accept");this._setCookie(20*365,0,"normal");clearTimeout(this.timer);this.animationOrientation="up";this.startAnimation();};SlidingWindow.prototype.canShow=function(){var show=false;if(this._isCookieEnabled()&&this._isSupportedBrowser()){if(document.cookie.indexOf(this.baseId+"=")==-1){show=true;}}return show;};SlidingWindow.prototype.getRetryCountFromCookie=function(){if(this.cookies==null){this.cookies=this.parseCookies();}if(this.cookies[this.retryCookieName]){return this.cookies[this.retryCookieName];}return 0;};SlidingWindow.prototype.getMinorRetryCountFromCookie=function(){if(this.cookies==null){this.cookies=this.parseCookies();}if(this.cookies[this.minorRetryCookieName]){return this.cookies[this.minorRetryCookieName];}return 0;};SlidingWindow.prototype.getLastActionFromCookie=function(){if(this.cookies==null){this.cookies=this.parseCookies();}if(this.cookies[this.typeCookieName]){return this.cookies[this.typeCookieName];}return "normal";};SlidingWindow.prototype.actualizeCookie=function(){var cookieMinorRetry=0;cookieMinorRetry=parseInt(this.getMinorRetryCountFromCookie());var cookieRetry=0;if(this.getRetryCountFromCookie()<this.noActionPeriods.length-1){cookieRetry=parseInt(this.getRetryCountFromCookie())+1;}else{cookieRetry=0;}if(this.getLastActionFromCookie()!=="normal"){cookieRetry=0;}var period=this.noActionPeriods[cookieRetry];if(!this.cookieSaved){if(cookieMinorRetry<this.minorPeriodRepetition-1){this._setMinorCookie(cookieMinorRetry+1);}else{this._setCookie(period,cookieRetry,"normal");this._deleteMinorCookie();}this.cookieSaved=true;}};SlidingWindow.prototype._setCookie=function(period,retryCount,type){var type=type=="normal"?"normal":"close";var date=new Date();date.setTime(date.getTime()+(period*24*60*60*1000));document.cookie=this.baseId+"=true; expires="+date.toUTCString()+"; path=/";date.setTime(date.getTime()+10*365*24*60*60*1000);document.cookie=this.retryCookieName+"="+retryCount+"; expires="+date.toUTCString()+"; path=/";document.cookie=this.typeCookieName+"="+type+"; expires="+date.toUTCString()+"; path=/";};SlidingWindow.prototype._setMinorCookie=function(retryCount){var date=new Date();date.setTime(date.getTime()+10*365*24*60*60*1000);document.cookie=this.minorRetryCookieName+"="+retryCount+"; expires="+date.toUTCString()+"; path=/";};SlidingWindow.prototype._deleteMinorCookie=function(){var date=new Date();date.setTime(date.getTime()-365*24*60*60*1000);document.cookie=this.minorRetryCookieName+"=0; expires="+date.toUTCString()+"; path=/";};SlidingWindow.prototype.parseCookies=function(){var cookieList=document.cookie.split("; ");var cookieArray=new Array();for(var i=0;i<cookieList.length;i++){var name=cookieList[i].split("=");cookieArray[unescape(name[0])]=unescape(name[1]);}return cookieArray;};SlidingWindow.prototype.addListener=function(elm,eType,obj,func){var method=null;var toFold=null;if(obj==null){obj=this;}if(typeof obj=="function"){toFold=this._addListener(elm,eType,obj);}else{if(typeof obj=="object"){if(typeof func=="string"){if(typeof obj[func]=="function"){method=this._getMethod(obj,func,elm);toFold=this._addListener(elm,eType,method);}else{this._error("SlidingWindow.addListener: arguments[3] must be method of arguments[2]");}}else{if(typeof func=="function"){method=this._getMethod(obj,func,elm);toFold=this._addListener(elm,eType,method);}}}else{this._error("SlidingWindow.addListener: arguments[2] must be object or function");}}};SlidingWindow.prototype._addListener=function(elm,eType,func){if(document.addEventListener){if(window.opera&&(elm==window)){elm=document;}elm.addEventListener(eType,func,false);}else{if(document.attachEvent){elm.attachEvent("on"+eType,func);}}return [elm,eType,func];};SlidingWindow.prototype._getMethod=function(obj,func,elm){if(typeof func=="string"){if(typeof obj[func].canTransform=="undefined"){return function(e){return obj[func].apply(obj,[e,elm]);};}else{return obj[func];}}else{if(typeof func.canTransform=="undefined"){return function(e){return func.apply(obj,[e,elm]);};}else{return func;}}};SlidingWindow.prototype._error=function(text){if(this.debug==1){throw new Error(text);}else{this.error=true;}};SlidingWindow.prototype.bind=function(obj,fnc){return function(){return fnc.apply(obj,arguments);};};SlidingWindow.prototype._isCookieEnabled=function(){var cookieEnabled=navigator.cookieEnabled?true:false;if(typeof navigator.cookieEnabled=="undefined"&&!cookieEnabled){document.cookie="testcookie";cookieEnabled=(document.cookie.indexOf("testcookie")!=-1)?true:false;}return cookieEnabled;};SlidingWindow.prototype._isSupportedBrowser=function(){if(document.getAnonymousElementByAttribute&&document.getElementsByClassName){return true;}return false;};SlidingWindow.prototype.measure=function(type){if(this.measureDotUrl){var url=this.measureDotUrl;url=url.replace("${act}",type);url=url.replace("${ord}",parseInt(this.getRetryCountFromCookie())+1);url=url.replace("${ord2}",parseInt(this.getMinorRetryCountFromCookie())+1);var img=new Image(1,1);img.src=url;}};}
