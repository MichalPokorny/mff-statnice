\subsection{Referenèní integrita}

Jedná se o nástroj databázového stroje, který pomáhá udržovat
vztahy v relaènì propojených databázových tabulkách.

Referenèní integrita se definuje \emph{cizím klíèem}, a to pro dvojici tabulek,
nebo nad jednou tabulkou, která obsahuje na sobì závislá data (napøíklad
stromové struktury). Tabulka, v níž je pravidlo uvedeno, se nazývá podøízená
tabulka (používá se také anglický termín slave). Tabulka, jejíž jméno je v
omezení uvedeno je nadøízená tabulka (master). Pravidlo referenèní integrity
vyžaduje, aby každý záznam použitý v podøízené tabulce existoval v nadøízené
tabulce. To znamená, že každý záznam musí v cizím klíèi obsahovat hodnoty
odpovídající primárními klíèi v nadøízené tabulce, nebo null.

To sebou nese dva dùsledky:
\begin{pitemize}
\item pøi pøidání záznamu do podøízené tabulky se kontroluje, zda stejná hodnota
klíèe existuje v nadøízené tabulce – porušení pravidla vyvolá chybu,
\item pøi mazání nebo úpravì záznamù v nadøízené tabulce se kontroluje, zda
v podøízené tabulce není záznam se stejnou hodnotou klíèe – porušení pravidla
mùže vyvolat chybu nebo úpravu dat v podøízené tabulky v souladu s definovanými
akcemi.
\end{pitemize}

\begin{obecne}{Pøíklad}
V databázi spolku pøátel psù máme následující tabulky:
\begin{pitemize}
 \item \emph{osoby} se sloupci \emph{\underline{osoba-id}} a \emph{jméno},
 \item \emph{psi} se sloupci \emph{\underline{pes-id}}, \emph{majitel} a \emph{rasa}.
\end{pitemize}

Aby byla data v databázi korektní, je tøeba, aby každý záznam psa mìl uvedeného
platného majitele. Proto oznaèíme v tabulce psi sloupec \emph{majitel} jako cizí
klíè, vztažený k sloupci (klíèi) \emph{osoba-id} v tabulce osoby. Když je poté
pøidán záznam pro psa, databáze bude vyžadovat, aby èíslo v poli \emph{majitel}
nabývalo nìkteré z existujících hodnot \emph{osoba-id} tabulky osoby. Zároveò
mùžeme urèit, zda se pøi smazání osoby smažou i záznamy všech psù, kterým je
osoba majitelem, nebo zda má pokus o smazání osoby vlastnící alespoò jednoho psa
selhat.
\end{obecne}

Existuje tedy nìkolik \emph{referenèních akcí}, které mohou být vyvolány, když
dochází ke zmìnì nebo mazání v závislých tabulkách:
\begin{description}
  \item[CASCADE] -- Pokud je smazán øádek v nadøízené tabulce, øádky z podøízené
  tabulky obsahující mazaný cizí klíè budou smazány také.

  \item[RESTRICT] -- Øádek v nadøízené tabulce nesmí být smazán ani zmìnìn, pokud
  v podøízené tabulce existují závisející øádky. Nedojde ani k pokusu o zmìnu dat.
  
  \item[NO ACTION] -- Operace Update nebo Delete je spuštìna na nadøízenou tabulku
  a na konci je teprve vyhodnoceno, jestli nedošlo k porušení integrity. Rozdíl
  oproti akci RESTRICT je ten, že samotným dotazem, nebo napøíklad triggerem mùže
  být zaøízeno, aby k porušení integrity nedošlo. Potom je operace normálnì
  provedena.
  
  \item[SET NULL] -- Cizí klíè v podøízené tabulce je nastaven na \emph{null},
  pokud dojde ke zmìnì èi smazání v odpovídajícím øádku nadøízené tabulky.

  \item[SET DEFAULT] -- Témìø to samé jako SET NULL, hodnoty cizího klíèe jsou
  nastaveny na defaultní hodnotu sloupce, pokud dojde ke zmìnì èi smazání
  odpovídajícího øádku v nadøízené tabulce.
\end{description}
